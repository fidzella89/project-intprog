{"ast":null,"code":"import { HttpResponse, HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { of, throwError } from 'rxjs';\nimport { delay, materialize, dematerialize } from 'rxjs/operators';\nimport { Role } from '@app/_models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@app/_services\";\n// array in local storage for accounts\nconst accountsKey = 'request-management-accounts';\nlet accounts = JSON.parse(localStorage.getItem(accountsKey)) || [];\n// array in local storage for employees\nconst employeesKey = 'request-management-employees';\nlet employees = JSON.parse(localStorage.getItem(employeesKey)) || [];\n// array in local storage for departments\nconst departmentsKey = 'request-management-departments';\nlet departments = JSON.parse(localStorage.getItem(departmentsKey)) || [{\n  id: 1,\n  name: 'HR',\n  description: 'Human Resources'\n}, {\n  id: 2,\n  name: 'IT',\n  description: 'Information Technology'\n}, {\n  id: 3,\n  name: 'Finance',\n  description: 'Finance Department'\n}, {\n  id: 4,\n  name: 'Marketing',\n  description: 'Marketing Department'\n}];\n// array in local storage for requests and their items\nconst requestsKey = 'request-management-requests';\nlet requests = JSON.parse(localStorage.getItem(requestsKey)) || [];\n// array in local storage for request items\nconst requestItemsKey = 'request-management-items';\nlet requestItems = JSON.parse(localStorage.getItem(requestItemsKey)) || [];\n// array in local storage for workflows\nconst workflowsKey = 'request-management-workflows';\nlet workflows = JSON.parse(localStorage.getItem(workflowsKey)) || [];\n// array in local storage for employee positions\nconst positionsKey = 'request-management-positions';\nlet positions = JSON.parse(localStorage.getItem(positionsKey)) || [{\n  id: 1,\n  name: 'Manager',\n  description: 'Department Manager'\n}, {\n  id: 2,\n  name: 'Team Lead',\n  description: 'Team Leader'\n}, {\n  id: 3,\n  name: 'Senior Staff',\n  description: 'Senior Level Staff'\n}, {\n  id: 4,\n  name: 'Junior Staff',\n  description: 'Junior Level Staff'\n}];\n// array in local storage for request types\nconst requestTypesKey = 'request-management-request-types';\nlet requestTypes = JSON.parse(localStorage.getItem(requestTypesKey)) || [{\n  id: 1,\n  name: 'Leave Request',\n  description: 'Request for leave or time off'\n}, {\n  id: 2,\n  name: 'Equipment Request',\n  description: 'Request for office equipment'\n}, {\n  id: 3,\n  name: 'Training Request',\n  description: 'Request for training or workshops'\n}, {\n  id: 4,\n  name: 'Other',\n  description: 'Other types of requests'\n}];\nexport let FakeBackendInterceptor = /*#__PURE__*/(() => {\n  class FakeBackendInterceptor {\n    constructor(alertService) {\n      this.alertService = alertService;\n    }\n    intercept(request, next) {\n      const {\n        url,\n        method,\n        headers,\n        body\n      } = request;\n      const alertService = this.alertService;\n      return handleRoute().pipe(delay(500),\n      // Simulate server delay\n      materialize(), dematerialize());\n      function handleRoute() {\n        switch (true) {\n          case url.endsWith('/accounts/authenticate') && method === 'POST':\n            return authenticate();\n          case url.endsWith('/accounts/refresh-token') && method === 'POST':\n            return refreshToken();\n          case url.endsWith('/accounts/revoke-token') && method === 'POST':\n            return revokeToken();\n          case url.endsWith('/accounts/register') && method === 'POST':\n            return register();\n          case url.endsWith('/accounts/verify-email') && method === 'POST':\n            return verifyEmail();\n          case url.endsWith('/accounts') && method === 'GET':\n            return getAccounts();\n          case url.match(/\\/accounts\\/\\d+$/) && method === 'GET':\n            return getAccountById();\n          case url.endsWith('/accounts') && method === 'POST':\n            return createAccount();\n          case url.match(/\\/accounts\\/\\d+$/) && method === 'PUT':\n            return updateAccount();\n          case url.match(/\\/accounts\\/\\d+$/) && method === 'DELETE':\n            return deleteAccount();\n          // request routes\n          case url.endsWith('/requests') && method === 'GET':\n            return getRequests();\n          case url.match(/\\/requests\\/\\d+$/) && method === 'GET':\n            return getRequestById();\n          case url.match(/\\/requests\\/employee\\/\\d+$/) && method === 'GET':\n            return getRequestsByEmployeeId();\n          case url.endsWith('/requests/my-requests') && method === 'GET':\n            return getMyRequests();\n          case url.endsWith('/requests') && method === 'POST':\n            return createRequest();\n          case url.match(/\\/requests\\/\\d+$/) && method === 'PUT':\n            return updateRequest();\n          case url.match(/\\/requests\\/\\d+\\/status$/) && method === 'PUT':\n            return changeRequestStatus();\n          case url.match(/\\/requests\\/\\d+$/) && method === 'DELETE':\n            return deleteRequest();\n          // employee routes\n          case url.endsWith('/employees') && method === 'GET':\n            return getEmployees();\n          case url.match(/\\/employees\\/\\d+$/) && method === 'GET':\n            return getEmployeeById();\n          case url.endsWith('/employees') && method === 'POST':\n            return createEmployee();\n          case url.match(/\\/employees\\/\\d+$/) && method === 'PUT':\n            return updateEmployee();\n          case url.match(/\\/employees\\/\\d+$/) && method === 'DELETE':\n            return deleteEmployee();\n          case url.match(/\\/employees\\/\\d+\\/transfer$/) && method === 'PUT':\n            return transferEmployee();\n          // department routes\n          case url.endsWith('/departments') && method === 'GET':\n            return getDepartments();\n          case url.match(/\\/departments\\/\\d+$/) && method === 'GET':\n            return getDepartmentById();\n          case url.endsWith('/departments') && method === 'POST':\n            return createDepartment();\n          case url.match(/\\/departments\\/\\d+$/) && method === 'PUT':\n            return updateDepartment();\n          case url.match(/\\/departments\\/\\d+$/) && method === 'DELETE':\n            return deleteDepartment();\n          // position routes\n          case url.endsWith('/positions') && method === 'GET':\n            return getPositions();\n          case url.match(/\\/positions\\/\\d+$/) && method === 'GET':\n            return getPositionById();\n          case url.endsWith('/positions') && method === 'POST':\n            return createPosition();\n          case url.match(/\\/positions\\/\\d+$/) && method === 'PUT':\n            return updatePosition();\n          case url.match(/\\/positions\\/\\d+$/) && method === 'DELETE':\n            return deletePosition();\n          // request type routes\n          case url.endsWith('/request-types') && method === 'GET':\n            return getRequestTypes();\n          case url.match(/\\/request-types\\/\\d+$/) && method === 'GET':\n            return getRequestTypeById();\n          case url.endsWith('/request-types') && method === 'POST':\n            return createRequestType();\n          case url.match(/\\/request-types\\/\\d+$/) && method === 'PUT':\n            return updateRequestType();\n          case url.match(/\\/request-types\\/\\d+$/) && method === 'DELETE':\n            return deleteRequestType();\n          // workflow routes\n          case url.endsWith('/workflows') && method === 'GET':\n            return getWorkflows();\n          case url.match(/\\/workflows\\/\\d+$/) && method === 'GET':\n            return getWorkflowById();\n          case url.match(/\\/workflows\\/employee\\/\\d+$/) && method === 'GET':\n            return getWorkflowsByEmployeeId();\n          case url.match(/\\/workflows\\/request\\/\\d+$/) && method === 'GET':\n            return getWorkflowsByRequestId();\n          case url.endsWith('/workflows') && method === 'POST':\n            return createWorkflow();\n          case url.match(/\\/workflows\\/\\d+$/) && method === 'PUT':\n            return updateWorkflow();\n          case url.match(/\\/workflows\\/\\d+\\/status$/) && method === 'PUT':\n            return updateWorkflowStatus();\n          case url.match(/\\/workflows\\/\\d+$/) && method === 'DELETE':\n            return deleteWorkflow();\n          case url.match(/\\/workflows\\/items\\/\\d+$/) && method === 'DELETE':\n            return deleteWorkflowItem();\n          default:\n            return next.handle(request);\n        }\n      }\n      // Authentication functions\n      function authenticate() {\n        const {\n          email,\n          password\n        } = body;\n        const account = accounts.find(x => x.email === email);\n        if (!account) return error('Email or password is incorrect');\n        if (password !== account.password) return error('Email or password is incorrect');\n        if (!account.isVerified) return error('Please verify your email before logging in');\n        // Generate refresh token and save\n        const refreshToken = generateRefreshToken();\n        account.refreshTokens = account.refreshTokens || [];\n        account.refreshTokens.push(refreshToken);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        // Return basic details and tokens\n        return ok(Object.assign(Object.assign({}, basicDetails(account)), {\n          jwtToken: generateJwtToken(account),\n          refreshToken\n        }));\n      }\n      function refreshToken() {\n        const refreshToken = getRefreshToken();\n        if (!refreshToken) return unauthorized();\n        const account = accounts.find(x => {\n          var _a;\n          return (_a = x.refreshTokens) === null || _a === void 0 ? void 0 : _a.includes(refreshToken);\n        });\n        if (!account) return unauthorized();\n        // Generate new refresh token and save\n        const newRefreshToken = generateRefreshToken();\n        account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n        account.refreshTokens.push(newRefreshToken);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        // Return basic details and tokens\n        return ok(Object.assign(Object.assign({}, basicDetails(account)), {\n          jwtToken: generateJwtToken(account),\n          refreshToken: newRefreshToken\n        }));\n      }\n      function revokeToken() {\n        if (!isAuthenticated()) return unauthorized();\n        const refreshToken = getRefreshToken();\n        const account = accounts.find(x => x.refreshTokens.includes(refreshToken));\n        // revoke token and save\n        account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      function register() {\n        const account = body;\n        if (accounts.find(x => x.email === account.email)) {\n          // display email already registered message in alert\n          setTimeout(() => {\n            alertService.info(`\n                        <h4>Email Already Registered</h4>\n                        <p>Your email ${account.email} is already registered.</p>\n                        <p>If you don't know your password please visit the <a href=\"${location.origin}/account/forgot-password\">forgot password</a> page.</p>\n                        <div>\n                        <strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.\n                        </div>\n                    `, {\n              autoclose: false\n            });\n          }, 1000);\n          // always return ok() response to prevent email enumeration\n          return ok();\n        }\n        // assign account id and a few other properties then save\n        account.id = newAccountId();\n        // Make sure there is at least one admin account\n        const hasAdmin = accounts.some(x => x.role === Role.Admin);\n        if (!hasAdmin || account.id === 1) {\n          account.role = Role.Admin;\n          account.status = 'Active';\n          account.isVerified = true;\n        } else {\n          account.role = Role.User;\n          account.status = 'Inactive';\n          account.isVerified = false;\n        }\n        account.dateCreated = new Date().toISOString();\n        account.verificationToken = new Date().getTime().toString();\n        account.refreshTokens = [];\n        delete account.confirmPassword;\n        accounts.push(account);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        // display verification email in alert\n        setTimeout(() => {\n          const verifyUrl = `${location.origin}/account/verify-email?token=${account.verificationToken}`;\n          alertService.info(`\n                    <h4>Verification Email</h4>\n                    <p>Thanks for registering!</p>\n                    <p>Please click the below link to verify your email address:</p>\n                    <p><a href=\"${verifyUrl}\">${verifyUrl}</a></p>\n                    <div><strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.</div>\n                `, {\n            autoclose: false\n          });\n        }, 1000);\n        return ok();\n      }\n      function verifyEmail() {\n        const {\n          token\n        } = body;\n        const account = accounts.find(x => !!x.verificationToken && x.verificationToken === token);\n        if (!account) return error('Verification failed');\n        // set is verified flag to true if token is valid\n        account.isVerified = true;\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      function getAccounts() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(accounts.map(x => basicDetails(x)));\n      }\n      function getAccountById() {\n        if (!isAuthenticated()) return unauthorized();\n        let account = accounts.find(x => x.id === idFromUrl());\n        // user accounts can get own profile and admin accounts can get all profiles\n        if (account.id !== currentAccount().id && !isAdmin()) {\n          return unauthorized();\n        }\n        return ok(basicDetails(account));\n      }\n      // Request functions\n      function getRequests() {\n        if (!isAuthenticated()) return unauthorized();\n        // Return all requests for admins, or filtered for regular users\n        let filteredRequests = [...requests];\n        if (!isAdmin()) {\n          const currentUserId = currentAccount().id;\n          filteredRequests = requests.filter(x => x.employeeId === currentUserId);\n        }\n        return ok(filteredRequests.map(request => {\n          const items = requestItems.filter(item => item.requestId === request.id);\n          const requestEmployee = employees.find(e => e.id === request.employeeId);\n          const requestAccount = accounts.find(a => a.id === (requestEmployee === null || requestEmployee === void 0 ? void 0 : requestEmployee.accountId));\n          const requestType = requestTypes.find(t => t.id === request.typeId);\n          return {\n            id: request.id,\n            employeeId: (requestEmployee === null || requestEmployee === void 0 ? void 0 : requestEmployee.employeeId) || '',\n            type: (requestType === null || requestType === void 0 ? void 0 : requestType.name) || request.type || '',\n            status: request.status,\n            createdDate: request.createdDate,\n            items: items,\n            employee: {\n              id: requestEmployee === null || requestEmployee === void 0 ? void 0 : requestEmployee.id,\n              employeeId: requestEmployee === null || requestEmployee === void 0 ? void 0 : requestEmployee.employeeId,\n              fullName: requestAccount ? `${requestAccount.firstName} ${requestAccount.lastName}`.trim() : ''\n            }\n          };\n        }));\n      }\n      function getRequestById() {\n        if (!isAuthenticated()) return unauthorized();\n        const request = requests.find(x => x.id === idFromUrl());\n        if (!request) return notFound();\n        // Check authorization\n        if (!isAdmin() && request.employeeId !== currentAccount().id) {\n          return unauthorized();\n        }\n        // Add related data\n        const items = requestItems.filter(item => item.requestId === request.id);\n        const employee = employees.find(e => e.id === request.employeeId);\n        const account = accounts.find(a => a.id === (employee === null || employee === void 0 ? void 0 : employee.accountId));\n        const requestType = requestTypes.find(t => t.id === request.typeId);\n        return ok(Object.assign(Object.assign({}, request), {\n          items,\n          employee: employee ? Object.assign(Object.assign({}, employee), {\n            fullName: `${(account === null || account === void 0 ? void 0 : account.firstName) || ''} ${(account === null || account === void 0 ? void 0 : account.lastName) || ''}`.trim(),\n            employeeId: employee.employeeId\n          }) : null,\n          type: requestType ? requestType.name : request.type\n        }));\n      }\n      function getRequestsByEmployeeId() {\n        if (!isAuthenticated()) return unauthorized();\n        const internalId = parseInt(url.split('/').pop());\n        console.log('Looking for requests with employeeId:', internalId);\n        const employee = employees.find(e => e.id === internalId);\n        if (!employee) {\n          console.log('Employee not found with internal id:', internalId);\n          return notFound();\n        }\n        const employeeRequests = requests.filter(x => x.employeeId === employee.id);\n        console.log('Found requests:', employeeRequests.length);\n        return ok(employeeRequests.map(request => {\n          const items = requestItems.filter(item => item.requestId === request.id);\n          const requestType = requestTypes.find(t => t.id === request.typeId);\n          const account = accounts.find(a => a.id === employee.accountId);\n          return {\n            id: request.id,\n            employeeId: employee.employeeId,\n            type: (requestType === null || requestType === void 0 ? void 0 : requestType.name) || request.type,\n            status: request.status,\n            createdDate: request.createdDate,\n            items: items,\n            employee: {\n              id: employee.id,\n              employeeId: employee.employeeId,\n              fullName: account ? `${account.firstName} ${account.lastName}`.trim() : ''\n            }\n          };\n        }));\n      }\n      function getMyRequests() {\n        if (!isAuthenticated()) return unauthorized();\n        const currentUserId = currentAccount().id;\n        const myRequests = requests.filter(x => x.employeeId === currentUserId);\n        return ok(myRequests.map(request => {\n          const items = requestItems.filter(item => item.requestId === request.id);\n          const employee = employees.find(e => e.id === request.employeeId);\n          const account = accounts.find(a => a.id === (employee === null || employee === void 0 ? void 0 : employee.accountId));\n          const requestType = requestTypes.find(t => t.id === request.typeId);\n          return Object.assign(Object.assign({}, request), {\n            items,\n            employee: employee ? Object.assign(Object.assign({}, employee), {\n              fullName: `${(account === null || account === void 0 ? void 0 : account.firstName) || ''} ${(account === null || account === void 0 ? void 0 : account.lastName) || ''}`.trim(),\n              employeeId: employee.employeeId\n            }) : null,\n            type: requestType ? requestType.name : request.type\n          });\n        }));\n      }\n      function createRequest() {\n        if (!isAuthenticated()) return unauthorized();\n        console.log('Received request data:', body);\n        // Find employee by employeeId if provided, otherwise use current user\n        let targetEmployee;\n        if (body.employeeId) {\n          // First try to find by internal ID\n          targetEmployee = employees.find(e => e.id === Number(body.employeeId));\n          if (!targetEmployee) {\n            // If not found, try to find by employee ID string\n            targetEmployee = employees.find(e => e.employeeId === body.employeeId);\n          }\n          if (!targetEmployee) return error('Employee not found');\n        } else {\n          const currentUser = currentAccount();\n          targetEmployee = employees.find(e => e.accountId === currentUser.id);\n          if (!targetEmployee) return error('Current user is not an employee');\n        }\n        const request = {\n          id: newRequestId(),\n          employeeId: targetEmployee.id,\n          type: body.type,\n          description: body.description || '',\n          status: 'Pending',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        // Validate required fields\n        if (!request.type) {\n          return error('Request type is required');\n        }\n        // Validate and process items if present\n        let requestItemsList = [];\n        if (body.items && Array.isArray(body.items)) {\n          try {\n            requestItemsList = body.items.map(item => {\n              if (!item.name || !item.quantity) {\n                throw new Error('Invalid item data');\n              }\n              return {\n                id: newRequestItemId(),\n                requestId: request.id,\n                name: item.name,\n                quantity: Number(item.quantity)\n              };\n            });\n          } catch (error) {\n            return error('Invalid item data provided');\n          }\n        }\n        // Save request and items\n        requests.push(request);\n        if (requestItemsList.length > 0) {\n          requestItems.push(...requestItemsList);\n          localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n        }\n        localStorage.setItem(requestsKey, JSON.stringify(requests));\n        const account = accounts.find(a => a.id === targetEmployee.accountId);\n        return ok(Object.assign(Object.assign({}, request), {\n          items: requestItemsList,\n          employeeId: targetEmployee.employeeId,\n          employee: {\n            id: targetEmployee.id,\n            employeeId: targetEmployee.employeeId,\n            fullName: account ? `${account.firstName} ${account.lastName}`.trim() : ''\n          }\n        }));\n      }\n      function updateRequest() {\n        if (!isAuthenticated()) return unauthorized();\n        console.log('Received update data:', body);\n        const requestId = idFromUrl();\n        const request = requests.find(x => x.id === requestId);\n        if (!request) return notFound();\n        if (request.employeeId !== currentAccount().id && !isAdmin()) return unauthorized();\n        // Validate request type if changed\n        if (body.typeId) {\n          const typeId = Number(body.typeId);\n          const requestType = requestTypes.find(t => t.id === typeId);\n          if (!requestType) {\n            return error('Invalid request type');\n          }\n          request.typeId = typeId;\n        }\n        // Update basic request fields\n        Object.assign(request, {\n          description: body.description || request.description,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Handle item changes\n        if (body.itemChanges) {\n          try {\n            // Delete items\n            if (body.itemChanges.delete && Array.isArray(body.itemChanges.delete)) {\n              requestItems = requestItems.filter(item => item.requestId !== requestId || !body.itemChanges.delete.includes(item.id));\n            }\n            // Update items\n            if (body.itemChanges.update && Array.isArray(body.itemChanges.update)) {\n              body.itemChanges.update.forEach(updatedItem => {\n                if (!updatedItem.name || !updatedItem.quantity) {\n                  throw new Error('Invalid item data');\n                }\n                const item = requestItems.find(x => x.id === updatedItem.id);\n                if (item) {\n                  Object.assign(item, {\n                    name: updatedItem.name,\n                    quantity: Number(updatedItem.quantity)\n                  });\n                }\n              });\n            }\n            // Add new items\n            if (body.itemChanges.add && Array.isArray(body.itemChanges.add)) {\n              const newItems = body.itemChanges.add.map(item => {\n                if (!item.name || !item.quantity) {\n                  throw new Error('Invalid item data');\n                }\n                return {\n                  id: newRequestItemId(),\n                  requestId: requestId,\n                  name: item.name,\n                  quantity: Number(item.quantity)\n                };\n              });\n              requestItems.push(...newItems);\n            }\n            localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n          } catch (error) {\n            return error('Invalid item data provided');\n          }\n        }\n        localStorage.setItem(requestsKey, JSON.stringify(requests));\n        // Get related data for response\n        const employee = employees.find(e => e.id === request.employeeId);\n        const requestType = requestTypes.find(t => t.id === request.typeId);\n        return ok(Object.assign(Object.assign({}, request), {\n          items: requestItems.filter(item => item.requestId === requestId),\n          type: requestType.name,\n          employee: employee\n        }));\n      }\n      function changeRequestStatus() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const request = requests.find(x => x.id === idFromUrl());\n        if (!request) return notFound();\n        const newStatus = body.status;\n        Object.assign(request, {\n          status: newStatus,\n          lastModifiedDate: new Date().toISOString()\n        });\n        localStorage.setItem(requestsKey, JSON.stringify(requests));\n        // Get related data for response\n        const employee = employees.find(e => e.id === request.employeeId);\n        const requestType = requestTypes.find(t => t.id === request.typeId);\n        return ok(Object.assign(Object.assign({}, request), {\n          items: requestItems.filter(item => item.requestId === request.id),\n          employee: employee,\n          type: requestType.name\n        }));\n      }\n      function deleteRequest() {\n        if (!isAuthenticated()) return unauthorized();\n        const requestId = idFromUrl();\n        const request = requests.find(x => x.id === requestId);\n        if (!request) return notFound();\n        if (request.employeeId !== currentAccount().id && !isAdmin()) return unauthorized();\n        // Delete request and its items\n        requests = requests.filter(x => x.id !== requestId);\n        requestItems = requestItems.filter(x => x.requestId !== requestId);\n        localStorage.setItem(requestsKey, JSON.stringify(requests));\n        localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n        return ok();\n      }\n      // Employee functions\n      function getEmployees() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(employees.map(employee => {\n          const department = departments.find(d => d.id === employee.departmentId);\n          const account = accounts.find(a => a.id === employee.accountId);\n          return Object.assign(Object.assign({}, employee), {\n            employeeId: employee.employeeId,\n            fullName: account ? `${account.firstName} ${account.lastName}`.trim() : '',\n            department: department ? {\n              id: department.id,\n              name: department.name,\n              description: department.description\n            } : null\n          });\n        }));\n      }\n      function getEmployeeById() {\n        if (!isAuthenticated()) return unauthorized();\n        const employeeId = idFromUrl();\n        const employee = employees.find(x => x.id === employeeId);\n        if (!employee) return notFound();\n        // Get fresh department data\n        const department = departments.find(d => d.id === employee.departmentId);\n        if (!department) return error('Department not found');\n        const account = accounts.find(a => a.id === employee.accountId);\n        // Return complete employee data with fresh relations\n        return ok(Object.assign(Object.assign({}, employee), {\n          employeeId: employee.employeeId,\n          fullName: account ? `${account.firstName} ${account.lastName}`.trim() : '',\n          departmentName: department.name,\n          department: {\n            id: department.id,\n            name: department.name,\n            description: department.description\n          },\n          account: basicDetails(account)\n        }));\n      }\n      function createEmployee() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        // Log the received data for debugging\n        console.log('Received employee data:', body);\n        // Validate department exists\n        const department = departments.find(d => d.id === Number(body.departmentId));\n        if (!department) return error('Department not found');\n        const employee = Object.assign(Object.assign({}, body), {\n          id: newEmployeeId(),\n          accountId: Number(body.accountId),\n          employeeId: body.employeeId,\n          departmentId: Number(body.departmentId),\n          position: body.position,\n          hireDate: body.hireDate,\n          salary: Number(body.salary),\n          status: body.status,\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Check each required field individually and log the result\n        const requiredFields = {\n          accountId: !!employee.accountId,\n          employeeId: !!employee.employeeId,\n          departmentId: !!employee.departmentId,\n          position: !!employee.position,\n          hireDate: !!employee.hireDate,\n          salary: !!employee.salary,\n          status: !!employee.status\n        };\n        console.log('Field validation results:', requiredFields);\n        // Check if any required field is missing\n        const missingFields = Object.entries(requiredFields).filter(([_, isValid]) => !isValid).map(([fieldName]) => fieldName);\n        if (missingFields.length > 0) {\n          return error(`Required fields are missing: ${missingFields.join(', ')}`);\n        }\n        // Validate account exists\n        const account = accounts.find(a => a.id === employee.accountId);\n        if (!account) return error('Account not found');\n        // Create workflow entry for new employee\n        const workflow = {\n          id: newWorkflowId(),\n          employeeId: employee.id,\n          type: 'Added',\n          details: {\n            task: `New employee ${employee.employeeId} was added`,\n            additionalInfo: `Added to ${department.name} department as ${employee.position}`\n          },\n          status: 'Completed',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        employees.push(employee);\n        workflows.push(workflow);\n        localStorage.setItem(employeesKey, JSON.stringify(employees));\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, employee), {\n          departmentName: department.name,\n          department: {\n            id: department.id,\n            name: department.name,\n            description: department.description\n          },\n          account: basicDetails(account)\n        }));\n      }\n      function updateEmployee() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const employeeId = idFromUrl();\n        const employeeIndex = employees.findIndex(x => x.id === employeeId);\n        if (employeeIndex === -1) return notFound();\n        const oldEmployee = employees[employeeIndex];\n        const updatedEmployee = Object.assign(Object.assign(Object.assign({}, oldEmployee), body), {\n          id: employeeId,\n          accountId: body.accountId ? Number(body.accountId) : oldEmployee.accountId,\n          departmentId: body.departmentId ? Number(body.departmentId) : oldEmployee.departmentId,\n          position: body.position || oldEmployee.position,\n          salary: body.salary ? Number(body.salary) : oldEmployee.salary,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Validate department exists if changed\n        if (body.departmentId) {\n          const department = departments.find(d => d.id === updatedEmployee.departmentId);\n          if (!department) return error('Department not found');\n        }\n        // Validate account exists if changed\n        if (body.accountId) {\n          const account = accounts.find(a => a.id === updatedEmployee.accountId);\n          if (!account) return error('Account not found');\n        }\n        const department = departments.find(d => d.id === updatedEmployee.departmentId);\n        const account = accounts.find(a => a.id === updatedEmployee.accountId);\n        // Create workflow entry for updated employee\n        const workflow = {\n          id: newWorkflowId(),\n          employeeId: employeeId,\n          type: 'Updated',\n          details: {\n            task: `Employee ${updatedEmployee.employeeId} was updated`,\n            additionalInfo: `Updated in ${department.name} department as ${updatedEmployee.position}`\n          },\n          status: 'Completed',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        employees[employeeIndex] = updatedEmployee;\n        workflows.push(workflow);\n        localStorage.setItem(employeesKey, JSON.stringify(employees));\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, updatedEmployee), {\n          departmentName: department.name,\n          department: {\n            id: department.id,\n            name: department.name,\n            description: department.description\n          },\n          account: basicDetails(account)\n        }));\n      }\n      function deleteEmployee() {\n        var _a;\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const employeeId = idFromUrl();\n        const employee = employees.find(x => x.id === employeeId);\n        if (!employee) return notFound();\n        // Create workflow entry for deleted employee\n        const workflow = {\n          id: newWorkflowId(),\n          employeeId: employeeId,\n          type: 'Deleted',\n          details: {\n            task: `The Employee Named ${employee.firstName} ${employee.lastName} was deleted`,\n            additionalInfo: `Deleted from ${((_a = departments.find(d => d.id === employee.departmentId)) === null || _a === void 0 ? void 0 : _a.name) || 'Unknown'} department`\n          },\n          status: 'Completed',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        employees = employees.filter(x => x.id !== employeeId);\n        workflows.push(workflow);\n        localStorage.setItem(employeesKey, JSON.stringify(employees));\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok();\n      }\n      function transferEmployee() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const employeeId = idFromUrl();\n        const employee = employees.find(x => x.id === employeeId);\n        if (!employee) return notFound();\n        const oldDepartment = departments.find(d => d.id === employee.departmentId);\n        const newDepartmentId = Number(body.departmentId);\n        const newDepartment = departments.find(d => d.id === newDepartmentId);\n        if (!newDepartment) return error('New department not found');\n        if (employee.departmentId === newDepartmentId) return error('Employee is already in this department');\n        // Create a completely new employee object with updated data\n        const updatedEmployee = Object.assign(Object.assign({}, employee), {\n          departmentId: newDepartmentId,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Update the employee in the employees array\n        const employeeIndex = employees.findIndex(x => x.id === employeeId);\n        if (employeeIndex !== -1) {\n          employees[employeeIndex] = updatedEmployee;\n        }\n        // Create workflow entry for department transfer\n        const workflow = {\n          id: newWorkflowId(),\n          employeeId: employeeId,\n          type: 'Department Transfer',\n          details: {\n            task: `Employee ${employee.employeeId} was transferred`,\n            additionalInfo: `Transferred from ${(oldDepartment === null || oldDepartment === void 0 ? void 0 : oldDepartment.name) || 'Unknown'} to ${newDepartment.name} department`\n          },\n          status: 'Completed',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        workflows.push(workflow);\n        // Save changes to localStorage\n        localStorage.setItem(employeesKey, JSON.stringify(employees));\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        const account = accounts.find(a => a.id === updatedEmployee.accountId);\n        // Return complete updated employee data with fresh department info\n        return ok(Object.assign(Object.assign({}, updatedEmployee), {\n          departmentName: newDepartment.name,\n          department: {\n            id: newDepartment.id,\n            name: newDepartment.name,\n            description: newDepartment.description\n          },\n          account: basicDetails(account)\n        }));\n      }\n      // Department functions\n      function getDepartments() {\n        if (!isAuthenticated()) return unauthorized();\n        // Return consistent department structure\n        return ok(departments.map(dept => ({\n          id: dept.id,\n          name: dept.name,\n          description: dept.description\n        })));\n      }\n      function getDepartmentById() {\n        if (!isAuthenticated()) return unauthorized();\n        const department = departments.find(x => x.id === idFromUrl());\n        if (!department) return notFound();\n        // Return consistent department structure\n        return ok({\n          id: department.id,\n          name: department.name,\n          description: department.description\n        });\n      }\n      function createDepartment() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const department = body;\n        department.id = newDepartmentId();\n        department.createdDate = new Date().toISOString();\n        department.lastModifiedDate = new Date().toISOString();\n        departments.push(department);\n        localStorage.setItem(departmentsKey, JSON.stringify(departments));\n        return ok(department);\n      }\n      function updateDepartment() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const departmentId = idFromUrl();\n        const departmentIndex = departments.findIndex(x => x.id === departmentId);\n        if (departmentIndex === -1) return notFound();\n        departments[departmentIndex] = Object.assign(Object.assign(Object.assign({}, departments[departmentIndex]), body), {\n          id: departmentId,\n          lastModifiedDate: new Date().toISOString()\n        });\n        localStorage.setItem(departmentsKey, JSON.stringify(departments));\n        return ok(departments[departmentIndex]);\n      }\n      function deleteDepartment() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const departmentId = idFromUrl();\n        // Check if department has employees\n        if (employees.some(e => e.departmentId === departmentId)) {\n          return error('Cannot delete department with existing employees');\n        }\n        departments = departments.filter(x => x.id !== departmentId);\n        localStorage.setItem(departmentsKey, JSON.stringify(departments));\n        return ok();\n      }\n      // Position functions\n      function getPositions() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(positions);\n      }\n      function getPositionById() {\n        if (!isAuthenticated()) return unauthorized();\n        const position = positions.find(x => x.id === idFromUrl());\n        if (!position) return notFound();\n        return ok(position);\n      }\n      function createPosition() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const position = Object.assign(Object.assign({}, body), {\n          id: newPositionId(),\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        });\n        if (!position.name || !position.description) {\n          return error('Name and description are required');\n        }\n        positions.push(position);\n        localStorage.setItem(positionsKey, JSON.stringify(positions));\n        return ok(position);\n      }\n      function updatePosition() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const positionId = idFromUrl();\n        const positionIndex = positions.findIndex(x => x.id === positionId);\n        if (positionIndex === -1) return notFound();\n        positions[positionIndex] = Object.assign(Object.assign(Object.assign({}, positions[positionIndex]), body), {\n          id: positionId,\n          lastModifiedDate: new Date().toISOString()\n        });\n        localStorage.setItem(positionsKey, JSON.stringify(positions));\n        return ok(positions[positionIndex]);\n      }\n      function deletePosition() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const positionId = idFromUrl();\n        // Check if position has employees\n        if (employees.some(e => e.positionId === positionId)) {\n          return error('Cannot delete position with existing employees');\n        }\n        positions = positions.filter(x => x.id !== positionId);\n        localStorage.setItem(positionsKey, JSON.stringify(positions));\n        return ok();\n      }\n      // Request Type functions\n      function getRequestTypes() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(requestTypes);\n      }\n      function getRequestTypeById() {\n        if (!isAuthenticated()) return unauthorized();\n        const requestType = requestTypes.find(x => x.id === idFromUrl());\n        if (!requestType) return notFound();\n        return ok(requestType);\n      }\n      function createRequestType() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const requestType = Object.assign(Object.assign({}, body), {\n          id: newRequestTypeId(),\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        });\n        if (!requestType.name || !requestType.description) {\n          return error('Name and description are required');\n        }\n        requestTypes.push(requestType);\n        localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n        return ok(requestType);\n      }\n      function updateRequestType() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const requestTypeId = idFromUrl();\n        const requestTypeIndex = requestTypes.findIndex(x => x.id === requestTypeId);\n        if (requestTypeIndex === -1) return notFound();\n        requestTypes[requestTypeIndex] = Object.assign(Object.assign(Object.assign({}, requestTypes[requestTypeIndex]), body), {\n          id: requestTypeId,\n          lastModifiedDate: new Date().toISOString()\n        });\n        localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n        return ok(requestTypes[requestTypeIndex]);\n      }\n      function deleteRequestType() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const requestTypeId = idFromUrl();\n        // Check if request type is in use\n        if (requests.some(r => r.typeId === requestTypeId)) {\n          return error('Cannot delete request type that is in use');\n        }\n        requestTypes = requestTypes.filter(x => x.id !== requestTypeId);\n        localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n        return ok();\n      }\n      function newPositionId() {\n        return positions.length ? Math.max(...positions.map(x => x.id)) + 1 : 1;\n      }\n      function newRequestTypeId() {\n        return requestTypes.length ? Math.max(...requestTypes.map(x => x.id)) + 1 : 1;\n      }\n      // Workflow functions\n      function getWorkflows() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(workflows.map(workflow => {\n          const details = typeof workflow.details === 'object' ? `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` : workflow.details || '';\n          return {\n            id: workflow.id.toString(),\n            type: workflow.type,\n            details: details,\n            status: workflow.status,\n            datetimecreated: workflow.datetimecreated || workflow.createdDate\n          };\n        }));\n      }\n      function getWorkflowById() {\n        if (!isAuthenticated()) return unauthorized();\n        const workflow = workflows.find(x => x.id === idFromUrl());\n        if (!workflow) return notFound();\n        const details = typeof workflow.details === 'object' ? `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` : workflow.details || '';\n        return ok({\n          id: workflow.id.toString(),\n          type: workflow.type,\n          details: details,\n          status: workflow.status,\n          datetimecreated: workflow.datetimecreated || workflow.createdDate\n        });\n      }\n      function getWorkflowsByEmployeeId() {\n        if (!isAuthenticated()) return unauthorized();\n        const internalId = parseInt(url.split('/').pop());\n        console.log('Looking for requests with employeeId:', internalId);\n        const employee = employees.find(e => e.id === internalId);\n        if (!employee) {\n          console.log('Employee not found with internal id:', internalId);\n          return notFound();\n        }\n        const employeeRequests = requests.filter(x => x.employeeId === employee.id);\n        console.log('Found requests:', employeeRequests.length);\n        return ok(employeeRequests.map(request => {\n          const items = requestItems.filter(item => item.requestId === request.id);\n          const requestType = requestTypes.find(t => t.id === request.typeId);\n          const account = accounts.find(a => a.id === employee.accountId);\n          return {\n            id: request.id,\n            employeeId: employee.employeeId,\n            type: (requestType === null || requestType === void 0 ? void 0 : requestType.name) || request.type,\n            status: request.status,\n            createdDate: request.createdDate,\n            items: items,\n            employee: {\n              id: employee.id,\n              employeeId: employee.employeeId,\n              fullName: account ? `${account.firstName} ${account.lastName}`.trim() : ''\n            }\n          };\n        }));\n      }\n      function getWorkflowsByRequestId() {\n        if (!isAuthenticated()) return unauthorized();\n        const requestId = parseInt(url.split('/').pop());\n        const requestWorkflows = workflows.filter(x => x.requestId === requestId);\n        return ok(requestWorkflows.map(workflow => {\n          const details = typeof workflow.details === 'object' ? `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` : workflow.details || '';\n          const employee = employees.find(e => e.id === workflow.employeeId);\n          return Object.assign(Object.assign({}, workflow), {\n            details: details,\n            createdDate: new Date(workflow.createdDate).toLocaleString(),\n            employee: employee\n          });\n        }));\n      }\n      function createWorkflow() {\n        if (!isAuthenticated()) return unauthorized();\n        // Create a single timestamp for consistency\n        const now = new Date();\n        const formattedDate = now.toLocaleString();\n        const isoDate = now.toISOString();\n        // Validate required fields\n        if (!body.type || !body.details || !body.details.task) {\n          return error('Type and task details are required');\n        }\n        const workflow = Object.assign(Object.assign({}, body), {\n          id: newWorkflowId(),\n          type: body.type,\n          details: {\n            task: body.details.task,\n            additionalInfo: body.details.additionalInfo || ''\n          },\n          status: body.status || 'ForReviewing',\n          datetimecreated: isoDate,\n          lastModifiedDate: isoDate\n        });\n        const employee = employees.find(e => e.id === workflow.employeeId);\n        if (!employee) return error('Employee not found');\n        workflows.push(workflow);\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        // Return formatted response\n        return ok({\n          id: workflow.id.toString(),\n          employeeId: workflow.employeeId,\n          type: workflow.type,\n          details: `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}`,\n          status: workflow.status,\n          datetimecreated: formattedDate\n        });\n      }\n      function updateWorkflow() {\n        var _a, _b;\n        if (!isAuthenticated()) return unauthorized();\n        const workflowId = idFromUrl();\n        const workflowIndex = workflows.findIndex(x => x.id === workflowId);\n        if (workflowIndex === -1) return notFound();\n        const updatedWorkflow = Object.assign(Object.assign({}, workflows[workflowIndex]), {\n          type: body.type || workflows[workflowIndex].type,\n          details: {\n            task: ((_a = body.details) === null || _a === void 0 ? void 0 : _a.task) || workflows[workflowIndex].details.task,\n            additionalInfo: ((_b = body.details) === null || _b === void 0 ? void 0 : _b.additionalInfo) || workflows[workflowIndex].details.additionalInfo\n          },\n          status: body.status || workflows[workflowIndex].status,\n          lastModifiedDate: new Date().toISOString()\n        });\n        const employee = employees.find(e => e.id === updatedWorkflow.employeeId);\n        if (!employee) return error('Employee not found');\n        const account = accounts.find(a => a.id === employee.accountId);\n        workflows[workflowIndex] = updatedWorkflow;\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok({\n          id: updatedWorkflow.id.toString(),\n          type: updatedWorkflow.type,\n          details: {\n            task: updatedWorkflow.details.task,\n            additionalInfo: updatedWorkflow.details.additionalInfo\n          },\n          status: updatedWorkflow.status,\n          createdDate: updatedWorkflow.createdDate\n        });\n      }\n      function updateWorkflowStatus() {\n        if (!isAuthenticated()) return unauthorized();\n        const workflowId = idFromUrl();\n        const workflow = workflows.find(x => x.id === workflowId);\n        if (!workflow) return notFound();\n        workflow.status = body.status;\n        workflow.lastModifiedDate = new Date().toISOString();\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, workflow), {\n          employee: employees.find(e => e.id === workflow.employeeId)\n        }));\n      }\n      function deleteWorkflow() {\n        if (!isAuthenticated()) return unauthorized();\n        const workflowId = idFromUrl();\n        workflows = workflows.filter(x => x.id !== workflowId);\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok();\n      }\n      function deleteWorkflowItem() {\n        if (!isAuthenticated()) return unauthorized();\n        const itemId = idFromUrl();\n        const workflow = workflows.find(x => {\n          var _a;\n          return (_a = x.items) === null || _a === void 0 ? void 0 : _a.some(item => item.id === itemId);\n        });\n        if (workflow) {\n          workflow.items = workflow.items.filter(item => item.id !== itemId);\n          localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        }\n        return ok();\n      }\n      function newWorkflowId() {\n        return workflows.length ? Math.max(...workflows.map(x => parseInt(x.id))) + 1 : 1;\n      }\n      // Account functions\n      function createAccount() {\n        const account = Object.assign(Object.assign({}, body), {\n          id: newAccountId(),\n          dateCreated: new Date().toISOString(),\n          status: body.status || 'Active',\n          isVerified: true,\n          refreshTokens: []\n        });\n        // Validate required fields\n        if (!account.firstName || !account.lastName || !account.email || !account.password) {\n          return error('Required fields are missing');\n        }\n        // Check if email already exists\n        if (accounts.find(x => x.email === account.email)) {\n          return error(`Email ${account.email} is already registered`);\n        }\n        // Set role if not provided\n        if (!account.role) {\n          account.role = Role.User;\n        }\n        delete account.confirmPassword;\n        accounts.push(account);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok(Object.assign(Object.assign({}, basicDetails(account)), {\n          jwtToken: generateJwtToken(account)\n        }));\n      }\n      function updateAccount() {\n        if (!isAuthenticated()) return unauthorized();\n        const accountId = idFromUrl();\n        const account = accounts.find(x => x.id === accountId);\n        if (!account) return notFound();\n        // Users can only update their own account, admins can update any account\n        if (account.id !== currentAccount().id && !isAdmin()) {\n          return unauthorized();\n        }\n        // Only allow admins to update role\n        if (body.role && !isAdmin()) {\n          delete body.role;\n        }\n        // If email is being changed, make sure it's not already taken\n        if (body.email && body.email !== account.email && accounts.find(x => x.email === body.email)) {\n          return error(`Email ${body.email} is already taken`);\n        }\n        // Copy body to account and save\n        Object.assign(account, body);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok(Object.assign(Object.assign({}, basicDetails(account)), {\n          jwtToken: generateJwtToken(account)\n        }));\n      }\n      function deleteAccount() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const accountId = idFromUrl();\n        // Prevent deleting own account\n        if (accountId === currentAccount().id) {\n          return error('You cannot delete your own account');\n        }\n        accounts = accounts.filter(x => x.id !== accountId);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      // Helper functions\n      function ok(body) {\n        return of(new HttpResponse({\n          status: 200,\n          body\n        }));\n      }\n      function error(message) {\n        return throwError(() => ({\n          error: {\n            message\n          }\n        }));\n      }\n      function unauthorized() {\n        return throwError(() => ({\n          status: 401,\n          error: {\n            message: 'Unauthorized'\n          }\n        }));\n      }\n      function notFound() {\n        return throwError(() => ({\n          status: 404,\n          error: {\n            message: 'Not Found'\n          }\n        }));\n      }\n      function basicDetails(account) {\n        const {\n          id,\n          title,\n          firstName,\n          lastName,\n          email,\n          role,\n          status,\n          isVerified\n        } = account;\n        return {\n          id,\n          title,\n          firstName,\n          lastName,\n          email,\n          role,\n          status,\n          isVerified\n        };\n      }\n      function isAuthenticated() {\n        return !!currentAccount();\n      }\n      function isAdmin() {\n        var _a;\n        return ((_a = currentAccount()) === null || _a === void 0 ? void 0 : _a.role) === Role.Admin;\n      }\n      function isModerator() {\n        var _a;\n        return ((_a = currentAccount()) === null || _a === void 0 ? void 0 : _a.role) === Role.Moderator;\n      }\n      function currentAccount() {\n        var _a;\n        // Check if the authorization header exists and has a JWT token\n        if (!((_a = headers.get('Authorization')) === null || _a === void 0 ? void 0 : _a.startsWith('Bearer '))) return null;\n        // Get the account from the JWT token (in a real app this would validate the token)\n        const jwtToken = JSON.parse(atob(headers.get('Authorization').split('.')[1]));\n        const account = accounts.find(x => x.id === jwtToken.id);\n        return account;\n      }\n      function idFromUrl() {\n        const urlParts = url.split('/');\n        return parseInt(urlParts[urlParts.length - 1]);\n      }\n      function newRequestId() {\n        return requests.length ? Math.max(...requests.map(x => x.id)) + 1 : 1;\n      }\n      function newRequestItemId() {\n        return requestItems.length ? Math.max(...requestItems.map(x => x.id)) + 1 : 1;\n      }\n      function newAccountId() {\n        return accounts.length ? Math.max(...accounts.map(x => x.id)) + 1 : 1;\n      }\n      function generateJwtToken(account) {\n        // Create a JWT token that expires in 15 minutes\n        const tokenPayload = {\n          id: account.id,\n          role: account.role,\n          email: account.email,\n          exp: Math.floor(Date.now() / 1000) + 15 * 60 // 15 minutes from now\n        };\n\n        return `fake-jwt-token.${btoa(JSON.stringify(tokenPayload))}`;\n      }\n      function generateRefreshToken() {\n        return `fake-refresh-token-${Math.floor(Math.random() * 1000000000)}`;\n      }\n      function getRefreshToken() {\n        // Check Authorization header for refresh token\n        const authHeader = headers.get('Authorization');\n        if (!(authHeader === null || authHeader === void 0 ? void 0 : authHeader.startsWith('Bearer '))) return null;\n        return authHeader.split(' ')[1];\n      }\n      function newEmployeeId() {\n        return employees.length ? Math.max(...employees.map(x => x.id)) + 1 : 1;\n      }\n      function newDepartmentId() {\n        return departments.length ? Math.max(...departments.map(x => x.id)) + 1 : 1;\n      }\n    }\n  }\n  FakeBackendInterceptor.fac = function FakeBackendInterceptor_Factory(t) {\n    return new (t || FakeBackendInterceptor)(i0.inject(i1.AlertService));\n  };\n  FakeBackendInterceptor.prov = /*@__PURE__*/i0.defineInjectable({\n    token: FakeBackendInterceptor,\n    factory: FakeBackendInterceptor.fac\n  });\n  return FakeBackendInterceptor;\n})();\nexport const fakeBackendProvider = {\n  provide: HTTP_INTERCEPTORS,\n  useClass: FakeBackendInterceptor,\n  multi: true\n};","map":{"version":3,"mappings":"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","names":["HttpResponse","HTTP_INTERCEPTORS","of","throwError","delay","materialize","dematerialize","Role","accountsKey","accounts","JSON","parse","localStorage","getItem","employeesKey","employees","departmentsKey","departments","id","name","description","requestsKey","requests","requestItemsKey","requestItems","workflowsKey","workflows","positionsKey","positions","requestTypesKey","requestTypes","FakeBackendInterceptor","constructor","alertService","intercept","request","next","url","method","headers","body","handleRoute","pipe","endsWith","authenticate","refreshToken","revokeToken","register","verifyEmail","getAccounts","match","getAccountById","createAccount","updateAccount","deleteAccount","getRequests","getRequestById","getRequestsByEmployeeId","getMyRequests","createRequest","updateRequest","changeRequestStatus","deleteRequest","getEmployees","getEmployeeById","createEmployee","updateEmployee","deleteEmployee","transferEmployee","getDepartments","getDepartmentById","createDepartment","updateDepartment","deleteDepartment","getPositions","getPositionById","createPosition","updatePosition","deletePosition","getRequestTypes","getRequestTypeById","createRequestType","updateRequestType","deleteRequestType","getWorkflows","getWorkflowById","getWorkflowsByEmployeeId","getWorkflowsByRequestId","createWorkflow","updateWorkflow","updateWorkflowStatus","deleteWorkflow","deleteWorkflowItem","handle","email","password","account","find","x","error","isVerified","generateRefreshToken","refreshTokens","push","setItem","stringify","ok","basicDetails","jwtToken","generateJwtToken","getRefreshToken","unauthorized","includes","newRefreshToken","filter","isAuthenticated","setTimeout","info","location","origin","autoclose","newAccountId","hasAdmin","some","role","Admin","status","User","dateCreated","Date","toISOString","verificationToken","getTime","toString","confirmPassword","verifyUrl","token","map","idFromUrl","currentAccount","isAdmin","filteredRequests","currentUserId","employeeId","items","item","requestId","requestEmployee","e","requestAccount","a","accountId","requestType","t","typeId","type","createdDate","employee","fullName","firstName","lastName","trim","notFound","Object","internalId","parseInt","split","pop","console","log","employeeRequests","length","myRequests","targetEmployee","Number","currentUser","newRequestId","lastModifiedDate","requestItemsList","Array","isArray","quantity","Error","newRequestItemId","assign","itemChanges","delete","update","forEach","updatedItem","add","newItems","newStatus","department","d","departmentId","departmentName","newEmployeeId","position","hireDate","salary","requiredFields","missingFields","entries","_","isValid","fieldName","join","workflow","newWorkflowId","details","task","additionalInfo","employeeIndex","findIndex","oldEmployee","updatedEmployee","oldDepartment","newDepartmentId","newDepartment","dept","departmentIndex","newPositionId","positionId","positionIndex","newRequestTypeId","requestTypeId","requestTypeIndex","r","Math","max","datetimecreated","requestWorkflows","toLocaleString","now","formattedDate","isoDate","workflowId","workflowIndex","updatedWorkflow","itemId","message","title","isModerator","Moderator","get","startsWith","atob","urlParts","tokenPayload","exp","floor","btoa","random","authHeader","factory","fakeBackendProvider","provide","useClass","multi"],"sourceRoot":"","sources":["D:\\JiM\\School\\3rd Year\\2nd Semester\\SUBJECTS\\IT-INTPROG32\\Coding (INTPROG32)\\Final\\project6\\frontend\\src\\app\\_helpers\\fake-backend.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpRequest, HttpResponse, HttpHandler, HttpEvent, HttpInterceptor, HTTP_INTERCEPTORS, HttpHeaders } from '@angular/common/http';\nimport { Observable, of, throwError } from 'rxjs';\nimport { delay, materialize, dematerialize } from 'rxjs/operators';\n\nimport { AlertService } from '@app/_services';\nimport { Role } from '@app/_models';\n\n// array in local storage for accounts\nconst accountsKey = 'request-management-accounts';\nlet accounts = JSON.parse(localStorage.getItem(accountsKey)) || [];\n\n// array in local storage for employees\nconst employeesKey = 'request-management-employees';\nlet employees = JSON.parse(localStorage.getItem(employeesKey)) || [];\n\n// array in local storage for departments\nconst departmentsKey = 'request-management-departments';\nlet departments = JSON.parse(localStorage.getItem(departmentsKey)) || [\n    { id: 1, name: 'HR', description: 'Human Resources' },\n    { id: 2, name: 'IT', description: 'Information Technology' },\n    { id: 3, name: 'Finance', description: 'Finance Department' },\n    { id: 4, name: 'Marketing', description: 'Marketing Department' }\n];\n\n// array in local storage for requests and their items\nconst requestsKey = 'request-management-requests';\nlet requests = JSON.parse(localStorage.getItem(requestsKey)) || [];\n\n// array in local storage for request items\nconst requestItemsKey = 'request-management-items';\nlet requestItems = JSON.parse(localStorage.getItem(requestItemsKey)) || [];\n\n// array in local storage for workflows\nconst workflowsKey = 'request-management-workflows';\nlet workflows = JSON.parse(localStorage.getItem(workflowsKey)) || [];\n\n// array in local storage for employee positions\nconst positionsKey = 'request-management-positions';\nlet positions = JSON.parse(localStorage.getItem(positionsKey)) || [\n    { id: 1, name: 'Manager', description: 'Department Manager' },\n    { id: 2, name: 'Team Lead', description: 'Team Leader' },\n    { id: 3, name: 'Senior Staff', description: 'Senior Level Staff' },\n    { id: 4, name: 'Junior Staff', description: 'Junior Level Staff' }\n];\n\n// array in local storage for request types\nconst requestTypesKey = 'request-management-request-types';\nlet requestTypes = JSON.parse(localStorage.getItem(requestTypesKey)) || [\n    { id: 1, name: 'Leave Request', description: 'Request for leave or time off' },\n    { id: 2, name: 'Equipment Request', description: 'Request for office equipment' },\n    { id: 3, name: 'Training Request', description: 'Request for training or workshops' },\n    { id: 4, name: 'Other', description: 'Other types of requests' }\n];\n\n@Injectable()\nexport class FakeBackendInterceptor implements HttpInterceptor {\n    constructor(private alertService: AlertService) { }\n\n    intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n        const { url, method, headers, body } = request;\n        const alertService = this.alertService;\n\n        return handleRoute().pipe(\n            delay(500), // Simulate server delay\n            materialize(),\n            dematerialize()\n        );\n\n        function handleRoute() {\n            switch (true) {\n                case url.endsWith('/accounts/authenticate') && method === 'POST':\n                    return authenticate();\n                case url.endsWith('/accounts/refresh-token') && method === 'POST':\n                    return refreshToken();\n                case url.endsWith('/accounts/revoke-token') && method === 'POST':\n                    return revokeToken();\n                case url.endsWith('/accounts/register') && method === 'POST':\n                    return register();\n                case url.endsWith('/accounts/verify-email') && method === 'POST':\n                    return verifyEmail();\n                case url.endsWith('/accounts') && method === 'GET':\n                    return getAccounts();\n                case url.match(/\\/accounts\\/\\d+$/) && method === 'GET':\n                    return getAccountById();\n                case url.endsWith('/accounts') && method === 'POST':\n                    return createAccount();\n                case url.match(/\\/accounts\\/\\d+$/) && method === 'PUT':\n                    return updateAccount();\n                case url.match(/\\/accounts\\/\\d+$/) && method === 'DELETE':\n                    return deleteAccount();\n                    \n                // request routes\n                case url.endsWith('/requests') && method === 'GET':\n                    return getRequests();\n                case url.match(/\\/requests\\/\\d+$/) && method === 'GET':\n                    return getRequestById();\n                case url.match(/\\/requests\\/employee\\/\\d+$/) && method === 'GET':\n                    return getRequestsByEmployeeId();\n                case url.endsWith('/requests/my-requests') && method === 'GET':\n                    return getMyRequests();\n                case url.endsWith('/requests') && method === 'POST':\n                    return createRequest();\n                case url.match(/\\/requests\\/\\d+$/) && method === 'PUT':\n                    return updateRequest();\n                case url.match(/\\/requests\\/\\d+\\/status$/) && method === 'PUT':\n                    return changeRequestStatus();\n                case url.match(/\\/requests\\/\\d+$/) && method === 'DELETE':\n                    return deleteRequest();\n                    \n                // employee routes\n                case url.endsWith('/employees') && method === 'GET':\n                    return getEmployees();\n                case url.match(/\\/employees\\/\\d+$/) && method === 'GET':\n                    return getEmployeeById();\n                case url.endsWith('/employees') && method === 'POST':\n                    return createEmployee();\n                case url.match(/\\/employees\\/\\d+$/) && method === 'PUT':\n                    return updateEmployee();\n                case url.match(/\\/employees\\/\\d+$/) && method === 'DELETE':\n                    return deleteEmployee();\n                case url.match(/\\/employees\\/\\d+\\/transfer$/) && method === 'PUT':\n                    return transferEmployee();\n\n                // department routes\n                case url.endsWith('/departments') && method === 'GET':\n                    return getDepartments();\n                case url.match(/\\/departments\\/\\d+$/) && method === 'GET':\n                    return getDepartmentById();\n                case url.endsWith('/departments') && method === 'POST':\n                    return createDepartment();\n                case url.match(/\\/departments\\/\\d+$/) && method === 'PUT':\n                    return updateDepartment();\n                case url.match(/\\/departments\\/\\d+$/) && method === 'DELETE':\n                    return deleteDepartment();\n                    \n                // position routes\n                case url.endsWith('/positions') && method === 'GET':\n                    return getPositions();\n                case url.match(/\\/positions\\/\\d+$/) && method === 'GET':\n                    return getPositionById();\n                case url.endsWith('/positions') && method === 'POST':\n                    return createPosition();\n                case url.match(/\\/positions\\/\\d+$/) && method === 'PUT':\n                    return updatePosition();\n                case url.match(/\\/positions\\/\\d+$/) && method === 'DELETE':\n                    return deletePosition();\n\n                // request type routes\n                case url.endsWith('/request-types') && method === 'GET':\n                    return getRequestTypes();\n                case url.match(/\\/request-types\\/\\d+$/) && method === 'GET':\n                    return getRequestTypeById();\n                case url.endsWith('/request-types') && method === 'POST':\n                    return createRequestType();\n                case url.match(/\\/request-types\\/\\d+$/) && method === 'PUT':\n                    return updateRequestType();\n                case url.match(/\\/request-types\\/\\d+$/) && method === 'DELETE':\n                    return deleteRequestType();\n\n                // workflow routes\n                case url.endsWith('/workflows') && method === 'GET':\n                    return getWorkflows();\n                case url.match(/\\/workflows\\/\\d+$/) && method === 'GET':\n                    return getWorkflowById();\n                case url.match(/\\/workflows\\/employee\\/\\d+$/) && method === 'GET':\n                    return getWorkflowsByEmployeeId();\n                case url.match(/\\/workflows\\/request\\/\\d+$/) && method === 'GET':\n                    return getWorkflowsByRequestId();\n                case url.endsWith('/workflows') && method === 'POST':\n                    return createWorkflow();\n                case url.match(/\\/workflows\\/\\d+$/) && method === 'PUT':\n                    return updateWorkflow();\n                case url.match(/\\/workflows\\/\\d+\\/status$/) && method === 'PUT':\n                    return updateWorkflowStatus();\n                case url.match(/\\/workflows\\/\\d+$/) && method === 'DELETE':\n                    return deleteWorkflow();\n                case url.match(/\\/workflows\\/items\\/\\d+$/) && method === 'DELETE':\n                    return deleteWorkflowItem();\n                    \n                default:\n                    return next.handle(request);\n            }\n        }\n\n        // Authentication functions\n        function authenticate() {\n            const { email, password } = body;\n            const account = accounts.find(x => x.email === email);\n        \n            if (!account) return error('Email or password is incorrect');\n            if (password !== account.password) return error('Email or password is incorrect');\n            if (!account.isVerified) return error('Please verify your email before logging in');\n\n            // Generate refresh token and save\n            const refreshToken = generateRefreshToken();\n            account.refreshTokens = account.refreshTokens || [];\n            account.refreshTokens.push(refreshToken);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            // Return basic details and tokens\n            return ok({\n                ...basicDetails(account),\n                jwtToken: generateJwtToken(account),\n                refreshToken\n            });\n        }\n\n        function refreshToken() {\n            const refreshToken = getRefreshToken();\n            \n            if (!refreshToken) return unauthorized();\n\n            const account = accounts.find(x => x.refreshTokens?.includes(refreshToken));\n            \n            if (!account) return unauthorized();\n\n            // Generate new refresh token and save\n            const newRefreshToken = generateRefreshToken();\n            account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n            account.refreshTokens.push(newRefreshToken);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            // Return basic details and tokens\n            return ok({\n                ...basicDetails(account),\n                jwtToken: generateJwtToken(account),\n                refreshToken: newRefreshToken\n            });\n        }\n\n        function revokeToken() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const refreshToken = getRefreshToken();\n            const account = accounts.find(x => x.refreshTokens.includes(refreshToken));\n\n            // revoke token and save\n            account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        function register() {\n            const account = body;\n\n            if (accounts.find(x => x.email === account.email)) {\n                // display email already registered message in alert\n                setTimeout(() => {\n                    alertService.info(`\n                        <h4>Email Already Registered</h4>\n                        <p>Your email ${account.email} is already registered.</p>\n                        <p>If you don't know your password please visit the <a href=\"${location.origin}/account/forgot-password\">forgot password</a> page.</p>\n                        <div>\n                        <strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.\n                        </div>\n                    `, { autoclose: false });\n                }, 1000);\n\n                // always return ok() response to prevent email enumeration\n                return ok();\n            }\n\n            // assign account id and a few other properties then save\n            account.id = newAccountId();\n            \n            // Make sure there is at least one admin account\n            const hasAdmin = accounts.some(x => x.role === Role.Admin);\n            if (!hasAdmin || account.id === 1) {\n                account.role = Role.Admin;\n                account.status = 'Active';\n                account.isVerified = true;\n            } else {\n                account.role = Role.User;\n                account.status = 'Inactive';\n                account.isVerified = false;\n            }\n\n            account.dateCreated = new Date().toISOString();\n            account.verificationToken = new Date().getTime().toString();\n            account.refreshTokens = [];\n            delete account.confirmPassword;\n            accounts.push(account);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            // display verification email in alert\n            setTimeout(() => {\n                const verifyUrl = `${location.origin}/account/verify-email?token=${account.verificationToken}`;\n                alertService.info(`\n                    <h4>Verification Email</h4>\n                    <p>Thanks for registering!</p>\n                    <p>Please click the below link to verify your email address:</p>\n                    <p><a href=\"${verifyUrl}\">${verifyUrl}</a></p>\n                    <div><strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.</div>\n                `, { autoclose: false });\n            }, 1000);\n\n            return ok();\n        }\n\n        function verifyEmail() {\n            const { token } = body;\n            const account = accounts.find(x => !!x.verificationToken && x.verificationToken === token);\n\n            if (!account) return error('Verification failed');\n\n            // set is verified flag to true if token is valid\n            account.isVerified = true;\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        function getAccounts() {\n            if (!isAuthenticated()) return unauthorized();\n            return ok(accounts.map(x => basicDetails(x)));\n        }\n\n        function getAccountById() {\n            if (!isAuthenticated()) return unauthorized();\n\n            let account = accounts.find(x => x.id === idFromUrl());\n\n            // user accounts can get own profile and admin accounts can get all profiles\n            if (account.id !== currentAccount().id && !isAdmin()) {\n                return unauthorized();\n            }\n\n            return ok(basicDetails(account));\n        }\n\n        // Request functions\n        function getRequests() {\n            if (!isAuthenticated()) return unauthorized();\n\n            // Return all requests for admins, or filtered for regular users\n            let filteredRequests = [...requests];\n            if (!isAdmin()) {\n                const currentUserId = currentAccount().id;\n                filteredRequests = requests.filter(x => x.employeeId === currentUserId);\n            }\n\n            return ok(filteredRequests.map(request => {\n                const items = requestItems.filter(item => item.requestId === request.id);\n                const requestEmployee = employees.find(e => e.id === request.employeeId);\n                const requestAccount = accounts.find(a => a.id === requestEmployee?.accountId);\n                const requestType = requestTypes.find(t => t.id === request.typeId);\n\n                return {\n                    id: request.id,\n                    employeeId: requestEmployee?.employeeId || '',\n                    type: requestType?.name || request.type || '',\n                    status: request.status,\n                    createdDate: request.createdDate,\n                    items: items,\n                    employee: {\n                        id: requestEmployee?.id,\n                        employeeId: requestEmployee?.employeeId,\n                        fullName: requestAccount ? `${requestAccount.firstName} ${requestAccount.lastName}`.trim() : ''\n                    }\n                };\n            }));\n        }\n\n        function getRequestById() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const request = requests.find(x => x.id === idFromUrl());\n            if (!request) return notFound();\n\n            // Check authorization\n            if (!isAdmin() && request.employeeId !== currentAccount().id) {\n                return unauthorized();\n            }\n\n            // Add related data\n            const items = requestItems.filter(item => item.requestId === request.id);\n            const employee = employees.find(e => e.id === request.employeeId);\n            const account = accounts.find(a => a.id === employee?.accountId);\n            const requestType = requestTypes.find(t => t.id === request.typeId);\n\n            return ok({\n                ...request,\n                items,\n                employee: employee ? {\n                    ...employee,\n                    fullName: `${account?.firstName || ''} ${account?.lastName || ''}`.trim(),\n                    employeeId: employee.employeeId\n                } : null,\n                type: requestType ? requestType.name : request.type\n            });\n        }\n\n        function getRequestsByEmployeeId() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const internalId = parseInt(url.split('/').pop());\n            console.log('Looking for requests with employeeId:', internalId);\n\n            const employee = employees.find(e => e.id === internalId);\n            if (!employee) {\n                console.log('Employee not found with internal id:', internalId);\n                return notFound();\n            }\n            \n            const employeeRequests = requests.filter(x => x.employeeId === employee.id);\n            console.log('Found requests:', employeeRequests.length);\n\n            return ok(employeeRequests.map(request => {\n                const items = requestItems.filter(item => item.requestId === request.id);\n                const requestType = requestTypes.find(t => t.id === request.typeId);\n                const account = accounts.find(a => a.id === employee.accountId);\n\n                return {\n                    id: request.id,\n                    employeeId: employee.employeeId,\n                    type: requestType?.name || request.type,\n                    status: request.status,\n                    createdDate: request.createdDate,\n                    items: items,\n                    employee: {\n                        id: employee.id,\n                        employeeId: employee.employeeId,\n                        fullName: account ? `${account.firstName} ${account.lastName}`.trim() : ''\n                    }\n                };\n            }));\n        }\n\n        function getMyRequests() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const currentUserId = currentAccount().id;\n            const myRequests = requests.filter(x => x.employeeId === currentUserId);\n\n            return ok(myRequests.map(request => {\n                const items = requestItems.filter(item => item.requestId === request.id);\n                const employee = employees.find(e => e.id === request.employeeId);\n                const account = accounts.find(a => a.id === employee?.accountId);\n                const requestType = requestTypes.find(t => t.id === request.typeId);\n                return {\n                    ...request,\n                    items,\n                    employee: employee ? {\n                        ...employee,\n                        fullName: `${account?.firstName || ''} ${account?.lastName || ''}`.trim(),\n                        employeeId: employee.employeeId\n                    } : null,\n                    type: requestType ? requestType.name : request.type\n                };\n            }));\n        }\n\n        function createRequest() {\n            if (!isAuthenticated()) return unauthorized();\n\n            console.log('Received request data:', body);\n\n            // Find employee by employeeId if provided, otherwise use current user\n            let targetEmployee;\n            if (body.employeeId) {\n                // First try to find by internal ID\n                targetEmployee = employees.find(e => e.id === Number(body.employeeId));\n                if (!targetEmployee) {\n                    // If not found, try to find by employee ID string\n                    targetEmployee = employees.find(e => e.employeeId === body.employeeId);\n                }\n                if (!targetEmployee) return error('Employee not found');\n            } else {\n                const currentUser = currentAccount();\n                targetEmployee = employees.find(e => e.accountId === currentUser.id);\n                if (!targetEmployee) return error('Current user is not an employee');\n            }\n\n            const request = {\n                id: newRequestId(),\n                employeeId: targetEmployee.id,\n                type: body.type,\n                description: body.description || '',\n                status: 'Pending',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n\n            // Validate required fields\n            if (!request.type) {\n                return error('Request type is required');\n            }\n\n            // Validate and process items if present\n            let requestItemsList = [];\n            if (body.items && Array.isArray(body.items)) {\n                try {\n                    requestItemsList = body.items.map(item => {\n                        if (!item.name || !item.quantity) {\n                            throw new Error('Invalid item data');\n                        }\n                        return {\n                            id: newRequestItemId(),\n                            requestId: request.id,\n                            name: item.name,\n                            quantity: Number(item.quantity)\n                        };\n                    });\n                } catch (error) {\n                    return error('Invalid item data provided');\n                }\n            }\n\n            // Save request and items\n            requests.push(request);\n            if (requestItemsList.length > 0) {\n                requestItems.push(...requestItemsList);\n                localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n            }\n\n            localStorage.setItem(requestsKey, JSON.stringify(requests));\n\n            const account = accounts.find(a => a.id === targetEmployee.accountId);\n            return ok({\n                ...request,\n                items: requestItemsList,\n                employeeId: targetEmployee.employeeId,\n                employee: {\n                    id: targetEmployee.id,\n                    employeeId: targetEmployee.employeeId,\n                    fullName: account ? `${account.firstName} ${account.lastName}`.trim() : ''\n                }\n            });\n        }\n\n        function updateRequest() {\n            if (!isAuthenticated()) return unauthorized();\n\n            console.log('Received update data:', body);\n\n            const requestId = idFromUrl();\n            const request = requests.find(x => x.id === requestId);\n\n            if (!request) return notFound();\n            if (request.employeeId !== currentAccount().id && !isAdmin()) return unauthorized();\n\n            // Validate request type if changed\n            if (body.typeId) {\n                const typeId = Number(body.typeId);\n                const requestType = requestTypes.find(t => t.id === typeId);\n                if (!requestType) {\n                    return error('Invalid request type');\n                }\n                request.typeId = typeId;\n            }\n\n            // Update basic request fields\n            Object.assign(request, {\n                description: body.description || request.description,\n                lastModifiedDate: new Date().toISOString()\n            });\n\n            // Handle item changes\n            if (body.itemChanges) {\n                try {\n                    // Delete items\n                    if (body.itemChanges.delete && Array.isArray(body.itemChanges.delete)) {\n                        requestItems = requestItems.filter(item => \n                            item.requestId !== requestId || \n                            !body.itemChanges.delete.includes(item.id)\n                        );\n                    }\n\n                    // Update items\n                    if (body.itemChanges.update && Array.isArray(body.itemChanges.update)) {\n                        body.itemChanges.update.forEach(updatedItem => {\n                            if (!updatedItem.name || !updatedItem.quantity) {\n                                throw new Error('Invalid item data');\n                            }\n                            const item = requestItems.find(x => x.id === updatedItem.id);\n                            if (item) {\n                                Object.assign(item, {\n                                    name: updatedItem.name,\n                                    quantity: Number(updatedItem.quantity)\n                                });\n                            }\n                        });\n                    }\n\n                    // Add new items\n                    if (body.itemChanges.add && Array.isArray(body.itemChanges.add)) {\n                        const newItems = body.itemChanges.add.map(item => {\n                            if (!item.name || !item.quantity) {\n                                throw new Error('Invalid item data');\n                            }\n                            return {\n                                id: newRequestItemId(),\n                                requestId: requestId,\n                                name: item.name,\n                                quantity: Number(item.quantity)\n                            };\n                        });\n                        requestItems.push(...newItems);\n                    }\n\n                    localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n                } catch (error) {\n                    return error('Invalid item data provided');\n                }\n            }\n\n            localStorage.setItem(requestsKey, JSON.stringify(requests));\n\n            // Get related data for response\n            const employee = employees.find(e => e.id === request.employeeId);\n            const requestType = requestTypes.find(t => t.id === request.typeId);\n\n            return ok({\n                ...request,\n                items: requestItems.filter(item => item.requestId === requestId),\n                type: requestType.name,\n                employee: employee\n            });\n        }\n\n        function changeRequestStatus() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const request = requests.find(x => x.id === idFromUrl());\n            if (!request) return notFound();\n\n            const newStatus = body.status;\n\n            Object.assign(request, {\n                status: newStatus,\n                lastModifiedDate: new Date().toISOString()\n            });\n\n            localStorage.setItem(requestsKey, JSON.stringify(requests));\n\n            // Get related data for response\n            const employee = employees.find(e => e.id === request.employeeId);\n            const requestType = requestTypes.find(t => t.id === request.typeId);\n\n            return ok({\n                ...request,\n                items: requestItems.filter(item => item.requestId === request.id),\n                employee: employee,\n                type: requestType.name\n            });\n        }\n\n        function deleteRequest() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const requestId = idFromUrl();\n            const request = requests.find(x => x.id === requestId);\n\n            if (!request) return notFound();\n            if (request.employeeId !== currentAccount().id && !isAdmin()) return unauthorized();\n\n            // Delete request and its items\n            requests = requests.filter(x => x.id !== requestId);\n            requestItems = requestItems.filter(x => x.requestId !== requestId);\n\n            localStorage.setItem(requestsKey, JSON.stringify(requests));\n            localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n\n            return ok();\n        }\n\n        // Employee functions\n        function getEmployees() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            return ok(employees.map(employee => {\n                const department = departments.find(d => d.id === employee.departmentId);\n                const account = accounts.find(a => a.id === employee.accountId);\n                return {\n                    ...employee,\n                    employeeId: employee.employeeId,\n                    fullName: account ? `${account.firstName} ${account.lastName}`.trim() : '',\n                    department: department ? {\n                        id: department.id,\n                        name: department.name,\n                        description: department.description\n                    } : null\n                };\n            }));\n        }\n\n        function getEmployeeById() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const employeeId = idFromUrl();\n            const employee = employees.find(x => x.id === employeeId);\n            \n            if (!employee) return notFound();\n            \n            // Get fresh department data\n            const department = departments.find(d => d.id === employee.departmentId);\n            if (!department) return error('Department not found');\n            \n            const account = accounts.find(a => a.id === employee.accountId);\n            \n            // Return complete employee data with fresh relations\n            return ok({\n                ...employee,\n                employeeId: employee.employeeId,\n                fullName: account ? `${account.firstName} ${account.lastName}`.trim() : '',\n                departmentName: department.name,\n                department: {\n                    id: department.id,\n                    name: department.name,\n                    description: department.description\n                },\n                account: basicDetails(account)\n            });\n        }\n\n        function createEmployee() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            // Log the received data for debugging\n            console.log('Received employee data:', body);\n\n            // Validate department exists\n            const department = departments.find(d => d.id === Number(body.departmentId));\n            if (!department) return error('Department not found');\n\n            const employee = {\n                ...body,\n                id: newEmployeeId(),\n                accountId: Number(body.accountId),\n                employeeId: body.employeeId,\n                departmentId: Number(body.departmentId),\n                position: body.position,\n                hireDate: body.hireDate,\n                salary: Number(body.salary),\n                status: body.status,\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            // Check each required field individually and log the result\n            const requiredFields = {\n                accountId: !!employee.accountId,\n                employeeId: !!employee.employeeId,\n                departmentId: !!employee.departmentId,\n                position: !!employee.position,\n                hireDate: !!employee.hireDate,\n                salary: !!employee.salary,\n                status: !!employee.status\n            };\n            \n            console.log('Field validation results:', requiredFields);\n            \n            // Check if any required field is missing\n            const missingFields = Object.entries(requiredFields)\n                .filter(([_, isValid]) => !isValid)\n                .map(([fieldName]) => fieldName);\n            \n            if (missingFields.length > 0) {\n                return error(`Required fields are missing: ${missingFields.join(', ')}`);\n            }\n\n            // Validate account exists\n            const account = accounts.find(a => a.id === employee.accountId);\n            if (!account) return error('Account not found');\n            \n            // Create workflow entry for new employee\n            const workflow = {\n                id: newWorkflowId(),\n                employeeId: employee.id,\n                type: 'Added',\n                details: {\n                    task: `New employee ${employee.employeeId} was added`,\n                    additionalInfo: `Added to ${department.name} department as ${employee.position}`\n                },\n                status: 'Completed',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            employees.push(employee);\n            workflows.push(workflow);\n            \n            localStorage.setItem(employeesKey, JSON.stringify(employees));\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                ...employee,\n                departmentName: department.name,\n                department: {\n                    id: department.id,\n                    name: department.name,\n                    description: department.description\n                },\n                account: basicDetails(account)\n            });\n        }\n\n        function updateEmployee() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const employeeId = idFromUrl();\n            const employeeIndex = employees.findIndex(x => x.id === employeeId);\n            \n            if (employeeIndex === -1) return notFound();\n            \n            const oldEmployee = employees[employeeIndex];\n            const updatedEmployee = {\n                ...oldEmployee,\n                ...body,\n                id: employeeId,\n                accountId: body.accountId ? Number(body.accountId) : oldEmployee.accountId,\n                departmentId: body.departmentId ? Number(body.departmentId) : oldEmployee.departmentId,\n                position: body.position || oldEmployee.position,\n                salary: body.salary ? Number(body.salary) : oldEmployee.salary,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            // Validate department exists if changed\n            if (body.departmentId) {\n                const department = departments.find(d => d.id === updatedEmployee.departmentId);\n                if (!department) return error('Department not found');\n            }\n\n            // Validate account exists if changed\n            if (body.accountId) {\n                const account = accounts.find(a => a.id === updatedEmployee.accountId);\n                if (!account) return error('Account not found');\n            }\n            \n            const department = departments.find(d => d.id === updatedEmployee.departmentId);\n            const account = accounts.find(a => a.id === updatedEmployee.accountId);\n            \n            // Create workflow entry for updated employee\n            const workflow = {\n                id: newWorkflowId(),\n                employeeId: employeeId,\n                type: 'Updated',\n                details: {\n                    task: `Employee ${updatedEmployee.employeeId} was updated`,\n                    additionalInfo: `Updated in ${department.name} department as ${updatedEmployee.position}`\n                },\n                status: 'Completed',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            employees[employeeIndex] = updatedEmployee;\n            workflows.push(workflow);\n            \n            localStorage.setItem(employeesKey, JSON.stringify(employees));\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                ...updatedEmployee,\n                departmentName: department.name,\n                department: {\n                    id: department.id,\n                    name: department.name,\n                    description: department.description\n                },\n                account: basicDetails(account)\n            });\n        }\n\n        function deleteEmployee() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const employeeId = idFromUrl();\n            const employee = employees.find(x => x.id === employeeId);\n            \n            if (!employee) return notFound();\n            \n            // Create workflow entry for deleted employee\n            const workflow = {\n                id: newWorkflowId(),\n                employeeId: employeeId,\n                type: 'Deleted',\n                details: {\n                    task: `The Employee Named ${employee.firstName} ${employee.lastName} was deleted`,\n                    additionalInfo: `Deleted from ${departments.find(d => d.id === employee.departmentId)?.name || 'Unknown'} department`\n                },\n                status: 'Completed',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            employees = employees.filter(x => x.id !== employeeId);\n            workflows.push(workflow);\n            \n            localStorage.setItem(employeesKey, JSON.stringify(employees));\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok();\n        }\n\n        function transferEmployee() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const employeeId = idFromUrl();\n            const employee = employees.find(x => x.id === employeeId);\n            \n            if (!employee) return notFound();\n            \n            const oldDepartment = departments.find(d => d.id === employee.departmentId);\n            const newDepartmentId = Number(body.departmentId);\n            const newDepartment = departments.find(d => d.id === newDepartmentId);\n            \n            if (!newDepartment) return error('New department not found');\n            if (employee.departmentId === newDepartmentId) return error('Employee is already in this department');\n            \n            // Create a completely new employee object with updated data\n            const updatedEmployee = {\n                ...employee,\n                departmentId: newDepartmentId,\n                lastModifiedDate: new Date().toISOString()\n            };\n\n            // Update the employee in the employees array\n            const employeeIndex = employees.findIndex(x => x.id === employeeId);\n            if (employeeIndex !== -1) {\n                employees[employeeIndex] = updatedEmployee;\n            }\n            \n            // Create workflow entry for department transfer\n            const workflow = {\n                id: newWorkflowId(),\n                employeeId: employeeId,\n                type: 'Department Transfer',\n                details: {\n                    task: `Employee ${employee.employeeId} was transferred`,\n                    additionalInfo: `Transferred from ${oldDepartment?.name || 'Unknown'} to ${newDepartment.name} department`\n                },\n                status: 'Completed',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            workflows.push(workflow);\n            \n            // Save changes to localStorage\n            localStorage.setItem(employeesKey, JSON.stringify(employees));\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            const account = accounts.find(a => a.id === updatedEmployee.accountId);\n            \n            // Return complete updated employee data with fresh department info\n            return ok({\n                ...updatedEmployee,\n                departmentName: newDepartment.name,\n                department: {\n                    id: newDepartment.id,\n                    name: newDepartment.name,\n                    description: newDepartment.description\n                },\n                account: basicDetails(account)\n            });\n        }\n\n        // Department functions\n        function getDepartments() {\n            if (!isAuthenticated()) return unauthorized();\n            // Return consistent department structure\n            return ok(departments.map(dept => ({\n                id: dept.id,\n                name: dept.name,\n                description: dept.description\n            })));\n        }\n\n        function getDepartmentById() {\n            if (!isAuthenticated()) return unauthorized();\n            const department = departments.find(x => x.id === idFromUrl());\n            if (!department) return notFound();\n            // Return consistent department structure\n            return ok({\n                id: department.id,\n                name: department.name,\n                description: department.description\n            });\n        }\n\n        function createDepartment() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const department = body;\n            department.id = newDepartmentId();\n            department.createdDate = new Date().toISOString();\n            department.lastModifiedDate = new Date().toISOString();\n            \n            departments.push(department);\n            localStorage.setItem(departmentsKey, JSON.stringify(departments));\n            \n            return ok(department);\n        }\n\n        function updateDepartment() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const departmentId = idFromUrl();\n            const departmentIndex = departments.findIndex(x => x.id === departmentId);\n            \n            if (departmentIndex === -1) return notFound();\n            \n            departments[departmentIndex] = {\n                ...departments[departmentIndex],\n                ...body,\n                id: departmentId,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            localStorage.setItem(departmentsKey, JSON.stringify(departments));\n            \n            return ok(departments[departmentIndex]);\n        }\n\n        function deleteDepartment() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const departmentId = idFromUrl();\n            \n            // Check if department has employees\n            if (employees.some(e => e.departmentId === departmentId)) {\n                return error('Cannot delete department with existing employees');\n            }\n            \n            departments = departments.filter(x => x.id !== departmentId);\n            localStorage.setItem(departmentsKey, JSON.stringify(departments));\n            \n            return ok();\n        }\n\n        // Position functions\n        function getPositions() {\n            if (!isAuthenticated()) return unauthorized();\n            return ok(positions);\n        }\n\n        function getPositionById() {\n            if (!isAuthenticated()) return unauthorized();\n            const position = positions.find(x => x.id === idFromUrl());\n            if (!position) return notFound();\n            return ok(position);\n        }\n\n        function createPosition() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const position = {\n                ...body,\n                id: newPositionId(),\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            if (!position.name || !position.description) {\n                return error('Name and description are required');\n            }\n            \n            positions.push(position);\n            localStorage.setItem(positionsKey, JSON.stringify(positions));\n            \n            return ok(position);\n        }\n\n        function updatePosition() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const positionId = idFromUrl();\n            const positionIndex = positions.findIndex(x => x.id === positionId);\n            \n            if (positionIndex === -1) return notFound();\n            \n            positions[positionIndex] = {\n                ...positions[positionIndex],\n                ...body,\n                id: positionId,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            localStorage.setItem(positionsKey, JSON.stringify(positions));\n            \n            return ok(positions[positionIndex]);\n        }\n\n        function deletePosition() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const positionId = idFromUrl();\n            \n            // Check if position has employees\n            if (employees.some(e => e.positionId === positionId)) {\n                return error('Cannot delete position with existing employees');\n            }\n            \n            positions = positions.filter(x => x.id !== positionId);\n            localStorage.setItem(positionsKey, JSON.stringify(positions));\n            \n            return ok();\n        }\n\n        // Request Type functions\n        function getRequestTypes() {\n            if (!isAuthenticated()) return unauthorized();\n            return ok(requestTypes);\n        }\n\n        function getRequestTypeById() {\n            if (!isAuthenticated()) return unauthorized();\n            const requestType = requestTypes.find(x => x.id === idFromUrl());\n            if (!requestType) return notFound();\n            return ok(requestType);\n        }\n\n        function createRequestType() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const requestType = {\n                ...body,\n                id: newRequestTypeId(),\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            if (!requestType.name || !requestType.description) {\n                return error('Name and description are required');\n            }\n            \n            requestTypes.push(requestType);\n            localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n            \n            return ok(requestType);\n        }\n\n        function updateRequestType() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const requestTypeId = idFromUrl();\n            const requestTypeIndex = requestTypes.findIndex(x => x.id === requestTypeId);\n            \n            if (requestTypeIndex === -1) return notFound();\n            \n            requestTypes[requestTypeIndex] = {\n                ...requestTypes[requestTypeIndex],\n                ...body,\n                id: requestTypeId,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n            \n            return ok(requestTypes[requestTypeIndex]);\n        }\n\n        function deleteRequestType() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const requestTypeId = idFromUrl();\n            \n            // Check if request type is in use\n            if (requests.some(r => r.typeId === requestTypeId)) {\n                return error('Cannot delete request type that is in use');\n            }\n            \n            requestTypes = requestTypes.filter(x => x.id !== requestTypeId);\n            localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n            \n            return ok();\n        }\n\n        function newPositionId() {\n            return positions.length ? Math.max(...positions.map(x => x.id)) + 1 : 1;\n        }\n\n        function newRequestTypeId() {\n            return requestTypes.length ? Math.max(...requestTypes.map(x => x.id)) + 1 : 1;\n        }\n\n        // Workflow functions\n        function getWorkflows() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            return ok(workflows.map(workflow => {\n                const details = typeof workflow.details === 'object' ? \n                    `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` :\n                    workflow.details || '';\n\n                return {\n                    id: workflow.id.toString(),\n                    type: workflow.type,\n                    details: details,\n                    status: workflow.status,\n                    datetimecreated: workflow.datetimecreated || workflow.createdDate\n                };\n            }));\n        }\n\n        function getWorkflowById() {\n            if (!isAuthenticated()) return unauthorized();\n            const workflow = workflows.find(x => x.id === idFromUrl());\n            if (!workflow) return notFound();\n            \n            const details = typeof workflow.details === 'object' ? \n                `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` :\n                workflow.details || '';\n\n            return ok({\n                id: workflow.id.toString(),\n                type: workflow.type,\n                details: details,\n                status: workflow.status,\n                datetimecreated: workflow.datetimecreated || workflow.createdDate\n            });\n        }\n\n        function getWorkflowsByEmployeeId() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const internalId = parseInt(url.split('/').pop());\n            console.log('Looking for requests with employeeId:', internalId);\n\n            const employee = employees.find(e => e.id === internalId);\n            if (!employee) {\n                console.log('Employee not found with internal id:', internalId);\n                return notFound();\n            }\n            \n            const employeeRequests = requests.filter(x => x.employeeId === employee.id);\n            console.log('Found requests:', employeeRequests.length);\n\n            return ok(employeeRequests.map(request => {\n                const items = requestItems.filter(item => item.requestId === request.id);\n                const requestType = requestTypes.find(t => t.id === request.typeId);\n                const account = accounts.find(a => a.id === employee.accountId);\n\n                return {\n                    id: request.id,\n                    employeeId: employee.employeeId,\n                    type: requestType?.name || request.type,\n                    status: request.status,\n                    createdDate: request.createdDate,\n                    items: items,\n                    employee: {\n                        id: employee.id,\n                        employeeId: employee.employeeId,\n                        fullName: account ? `${account.firstName} ${account.lastName}`.trim() : ''\n                    }\n                };\n            }));\n        }\n\n        function getWorkflowsByRequestId() {\n            if (!isAuthenticated()) return unauthorized();\n            const requestId = parseInt(url.split('/').pop());\n            const requestWorkflows = workflows.filter(x => x.requestId === requestId);\n            \n            return ok(requestWorkflows.map(workflow => {\n                const details = typeof workflow.details === 'object' ? \n                    `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` :\n                    workflow.details || '';\n\n                const employee = employees.find(e => e.id === workflow.employeeId);\n                return {\n                    ...workflow,\n                    details: details,\n                    createdDate: new Date(workflow.createdDate).toLocaleString(),\n                    employee: employee\n                };\n            }));\n        }\n\n        function createWorkflow() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            // Create a single timestamp for consistency\n            const now = new Date();\n            const formattedDate = now.toLocaleString();\n            const isoDate = now.toISOString();\n\n            // Validate required fields\n            if (!body.type || !body.details || !body.details.task) {\n                return error('Type and task details are required');\n            }\n\n            const workflow = {\n                ...body,\n                id: newWorkflowId(),\n                type: body.type,\n                details: {\n                    task: body.details.task,\n                    additionalInfo: body.details.additionalInfo || ''\n                },\n                status: body.status || 'ForReviewing',\n                datetimecreated: isoDate,\n                lastModifiedDate: isoDate\n            };\n            \n            const employee = employees.find(e => e.id === workflow.employeeId);\n            if (!employee) return error('Employee not found');\n            \n            workflows.push(workflow);\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            // Return formatted response\n            return ok({\n                id: workflow.id.toString(),\n                employeeId: workflow.employeeId,\n                type: workflow.type,\n                details: `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}`,\n                status: workflow.status,\n                datetimecreated: formattedDate\n            });\n        }\n\n        function updateWorkflow() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const workflowId = idFromUrl();\n            const workflowIndex = workflows.findIndex(x => x.id === workflowId);\n            \n            if (workflowIndex === -1) return notFound();\n            \n            const updatedWorkflow = {\n                ...workflows[workflowIndex],\n                type: body.type || workflows[workflowIndex].type,\n                details: {\n                    task: body.details?.task || workflows[workflowIndex].details.task,\n                    additionalInfo: body.details?.additionalInfo || workflows[workflowIndex].details.additionalInfo\n                },\n                status: body.status || workflows[workflowIndex].status,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            const employee = employees.find(e => e.id === updatedWorkflow.employeeId);\n            if (!employee) return error('Employee not found');\n            \n            const account = accounts.find(a => a.id === employee.accountId);\n            \n            workflows[workflowIndex] = updatedWorkflow;\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                id: updatedWorkflow.id.toString(),\n                type: updatedWorkflow.type,\n                details: {\n                    task: updatedWorkflow.details.task,\n                    additionalInfo: updatedWorkflow.details.additionalInfo\n                },\n                status: updatedWorkflow.status,\n                createdDate: updatedWorkflow.createdDate\n            });\n        }\n\n        function updateWorkflowStatus() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const workflowId = idFromUrl();\n            const workflow = workflows.find(x => x.id === workflowId);\n            \n            if (!workflow) return notFound();\n            \n            workflow.status = body.status;\n            workflow.lastModifiedDate = new Date().toISOString();\n            \n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                ...workflow,\n                employee: employees.find(e => e.id === workflow.employeeId)\n            });\n        }\n\n        function deleteWorkflow() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const workflowId = idFromUrl();\n            workflows = workflows.filter(x => x.id !== workflowId);\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok();\n        }\n\n        function deleteWorkflowItem() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const itemId = idFromUrl();\n            const workflow = workflows.find(x => x.items?.some(item => item.id === itemId));\n            \n            if (workflow) {\n                workflow.items = workflow.items.filter(item => item.id !== itemId);\n                localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            }\n            \n            return ok();\n        }\n\n        function newWorkflowId() {\n            return workflows.length ? Math.max(...workflows.map(x => parseInt(x.id))) + 1 : 1;\n        }\n\n        // Account functions\n        function createAccount() {\n            const account = {\n                ...body,\n                id: newAccountId(),\n                dateCreated: new Date().toISOString(),\n                status: body.status || 'Active',\n                isVerified: true, // Admin-created accounts are auto-verified\n                refreshTokens: []\n            };\n\n            // Validate required fields\n            if (!account.firstName || !account.lastName || !account.email || !account.password) {\n                return error('Required fields are missing');\n            }\n\n            // Check if email already exists\n            if (accounts.find(x => x.email === account.email)) {\n                return error(`Email ${account.email} is already registered`);\n            }\n\n            // Set role if not provided\n            if (!account.role) {\n                account.role = Role.User;\n            }\n\n            delete account.confirmPassword;\n            accounts.push(account);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok({\n                ...basicDetails(account),\n                jwtToken: generateJwtToken(account)\n            });\n        }\n\n        function updateAccount() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const accountId = idFromUrl();\n            const account = accounts.find(x => x.id === accountId);\n\n            if (!account) return notFound();\n\n            // Users can only update their own account, admins can update any account\n            if (account.id !== currentAccount().id && !isAdmin()) {\n                return unauthorized();\n            }\n\n            // Only allow admins to update role\n            if (body.role && !isAdmin()) {\n                delete body.role;\n            }\n\n            // If email is being changed, make sure it's not already taken\n            if (body.email && body.email !== account.email && accounts.find(x => x.email === body.email)) {\n                return error(`Email ${body.email} is already taken`);\n            }\n\n            // Copy body to account and save\n            Object.assign(account, body);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok({\n                ...basicDetails(account),\n                jwtToken: generateJwtToken(account)\n            });\n        }\n\n        function deleteAccount() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const accountId = idFromUrl();\n            \n            // Prevent deleting own account\n            if (accountId === currentAccount().id) {\n                return error('You cannot delete your own account');\n            }\n\n            accounts = accounts.filter(x => x.id !== accountId);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        // Helper functions\n        function ok(body?: any) {\n            return of(new HttpResponse({ status: 200, body }));\n        }\n\n        function error(message: string) {\n            return throwError(() => ({ error: { message } }));\n        }\n\n        function unauthorized() {\n            return throwError(() => ({ status: 401, error: { message: 'Unauthorized' } }));\n        }\n\n        function notFound() {\n            return throwError(() => ({ status: 404, error: { message: 'Not Found' } }));\n        }\n\n        function basicDetails(account: any) {\n            const { id, title, firstName, lastName, email, role, status, isVerified } = account;\n            return { id, title, firstName, lastName, email, role, status, isVerified };\n        }\n\n        function isAuthenticated() {\n            return !!currentAccount();\n        }\n\n        function isAdmin() {\n            return currentAccount()?.role === Role.Admin;\n        }\n\n        function isModerator() {\n            return currentAccount()?.role === Role.Moderator;\n        }\n\n        function currentAccount() {\n            // Check if the authorization header exists and has a JWT token\n            if (!headers.get('Authorization')?.startsWith('Bearer ')) return null;\n\n            // Get the account from the JWT token (in a real app this would validate the token)\n            const jwtToken = JSON.parse(atob(headers.get('Authorization').split('.')[1]));\n            const account = accounts.find(x => x.id === jwtToken.id);\n            return account;\n        }\n\n        function idFromUrl() {\n            const urlParts = url.split('/');\n            return parseInt(urlParts[urlParts.length - 1]);\n        }\n\n        function newRequestId() {\n            return requests.length ? Math.max(...requests.map(x => x.id)) + 1 : 1;\n        }\n\n        function newRequestItemId() {\n            return requestItems.length ? Math.max(...requestItems.map(x => x.id)) + 1 : 1;\n        }\n\n        function newAccountId() {\n            return accounts.length ? Math.max(...accounts.map(x => x.id)) + 1 : 1;\n        }\n\n        function generateJwtToken(account: any) {\n            // Create a JWT token that expires in 15 minutes\n            const tokenPayload = {\n                id: account.id,\n                role: account.role,\n                email: account.email,\n                exp: Math.floor(Date.now() / 1000) + (15 * 60) // 15 minutes from now\n            };\n            return `fake-jwt-token.${btoa(JSON.stringify(tokenPayload))}`;\n        }\n\n        function generateRefreshToken() {\n            return `fake-refresh-token-${Math.floor(Math.random() * 1000000000)}`;\n        }\n\n        function getRefreshToken() {\n            // Check Authorization header for refresh token\n            const authHeader = headers.get('Authorization');\n            if (!authHeader?.startsWith('Bearer ')) return null;\n            \n            return authHeader.split(' ')[1];\n        }\n\n        function newEmployeeId() {\n            return employees.length ? Math.max(...employees.map(x => x.id)) + 1 : 1;\n        }\n\n        function newDepartmentId() {\n            return departments.length ? Math.max(...departments.map(x => x.id)) + 1 : 1;\n        }\n    }\n}\n\nexport const fakeBackendProvider = {\n    provide: HTTP_INTERCEPTORS,\n    useClass: FakeBackendInterceptor,\n    multi: true\n};\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}